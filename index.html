<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mystic Tarot Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap');

        :root {
            --color-bg: #020617;
            --color-card: #0f172a;
        }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--color-bg);
            color: #f8fafc;
            -webkit-tap-highlight-color: transparent;
        }

        h1, h2, .font-serif {
            font-family: 'Cinzel', serif;
        }

        /* Hide scrollbar for cleaner look */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* Animations */
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="min-h-screen selection:bg-amber-500/30">

    <!-- App Container -->
    <div id="app"></div>

    <script>
        /**
         * --- ICONS (SVG STRINGS) ---
         */
        const ICONS = {
            chevronDown: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>`,
            arrowLeft: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></svg>`,
            refresh: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>`,
            moon: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>`,
            sun: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>`,
            sparkles: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>`,
            globe: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20"/><path d="M2 12h20"/></svg>`,
            // Major Arcana specific
            feather: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"/><line x1="16" y1="8" x2="2" y2="22"/><line x1="17.5" y1="15" x2="9" y2="15"/></svg>`,
            scroll: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 17.5a4.5 4.5 0 0 1 4.5-4.5H20"/><path d="M8 17.5a4.5 4.5 0 0 0 4.5 4.5H20"/><path d="M8 17.5V3a3 3 0 0 1 3 3v13a4.5 4.5 0 0 1-4.5 4.5H2"/><path d="M16 8v9a4 4 0 0 0 4-4V5a3 3 0 0 0-3-3h-4.5a3 3 0 0 0-3 3v2"/></svg>`,
            sprout: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 20h10"/><path d="M10 20c5.5-2.5.8-6.4 3-10"/><path d="M9.5 9.4c1.1.8 1.8 2.2 2.3 3.7-2 .4-3.5.4-4.8-.3-1.2-.6-2.3-1.9-3-4.2 2.8-.5 4.4 0 5.5.8z"/><path d="M14.1 6a7 7 0 0 0-1.1 4c1.9-.1 3.3-.6 4.3-1.4 1-1 1.6-2.3 1.7-4.6-2.7.1-4 1-4.9 2z"/></svg>`,
            crown: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg>`,
            key: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="7.5" cy="15.5" r="5.5"/><path d="m21 2-9.6 9.6"/><path d="m15.5 7.5 3 3L22 7l-3-3"/></svg>`,
            heart: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>`,
            shield: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>`,
            dna: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 15c6.667-6 13.333 0 20-6"/><path d="M9 22c1.798-1.998 2.518-3.995 2.807-5.993"/><path d="M15 2c-1.798 1.998-2.518 3.995-2.807 5.993"/><path d="M17 6l-2.5-2.5"/><path d="M14 8l-1-1"/><path d="M7 18l2.5 2.5"/><path d="M3.5 14.5l.5.5"/><path d="M20 9l.5.5"/><path d="M6.5 12.5l1 1"/><path d="M16.5 10.5l1 1"/><path d="M10 16l1.5 1.5"/></svg>`,
            search: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>`,
            scale: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1z"/><path d="m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1z"/><path d="M7 21h10"/><path d="M12 3v18"/><path d="M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2"/></svg>`,
            anchor: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="5" r="3"/><line x1="12" y1="22" x2="12" y2="8"/><path d="M5 12H2a10 10 0 0 0 20 0h-3"/></svg>`,
            skull: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></svg>`,
            droplets: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"/><path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"/></svg>`,
            flame: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-2.246-5.318-1-7 1.879 2.181 4.223 5.32 2 8 2.5-3.136 4.954-6.425 2-9 1.347 2.222 5.094 7.618 3.5 11.5a6 6 0 1 1-11.625-2.733c.636 1.838 1.63 3.29 2.625 4.733z"/></svg>`,
            zap: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>`,
            star: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>`,
            bell: `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>`,
            // Suit specifics
            cups: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C7.58 2 4 5.58 4 10C4 14.42 7.58 18 12 18C16.42 18 20 14.42 20 10C20 5.58 16.42 2 12 2ZM6 10C6 6.69 8.69 4 12 4C15.31 4 18 6.69 18 10C18 13.31 15.31 16 12 16C8.69 16 6 13.31 6 10Z"/><path d="M12 19C8.13 19 5 20.57 5 22H19C19 20.57 15.87 19 12 19Z"/></svg>`,
            wands: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M10 2L14 2L13 22L11 22L10 2Z"/></svg>`,
            swords: `<svg viewBox="0 0 24 24" fill="currentColor"><path d="M11 2L13 2L13 16L17 18L12 22L7 18L11 16L11 2Z"/></svg>`,
            pentacles: `<svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="8" stroke="currentColor" stroke-width="2" fill="none" /><path d="M12 4L14.5 9.5L20 10L16 14L17.5 20L12 17L6.5 20L8 14L4 10L9.5 9.5L12 4Z" /></svg>`
        };

        /**
         * --- DATA GENERATION ---
         */
        const SUITS = ['wands', 'cups', 'swords', 'pentacles'];
        const RANKS = [
            { num: 1, en: 'Ace', fr: 'As', es: 'As' },
            { num: 2, en: 'Two', fr: 'Deux', es: 'Dos' },
            { num: 3, en: 'Three', fr: 'Trois', es: 'Tres' },
            { num: 4, en: 'Four', fr: 'Quatre', es: 'Cuatro' },
            { num: 5, en: 'Five', fr: 'Cinq', es: 'Cinco' },
            { num: 6, en: 'Six', fr: 'Six', es: 'Seis' },
            { num: 7, en: 'Seven', fr: 'Sept', es: 'Siete' },
            { num: 8, en: 'Eight', fr: 'Huit', es: 'Ocho' },
            { num: 9, en: 'Nine', fr: 'Neuf', es: 'Nueve' },
            { num: 10, en: 'Ten', fr: 'Dix', es: 'Diez' },
            { num: 11, en: 'Page', fr: 'Valet', es: 'Sota' },
            { num: 12, en: 'Knight', fr: 'Cavalier', es: 'Caballo' },
            { num: 13, en: 'Queen', fr: 'Reine', es: 'Reina' },
            { num: 14, en: 'King', fr: 'Roi', es: 'Rey' },
        ];

        const MAJORS = [
            { num: 0, id: 'm00', en: "The Fool", fr: "Le Mat", es: "El Loco" },
            { num: 1, id: 'm01', en: "The Magician", fr: "Le Bateleur", es: "El Mago" },
            { num: 2, id: 'm02', en: "The High Priestess", fr: "La Papesse", es: "La Sacerdotisa" },
            { num: 3, id: 'm03', en: "The Empress", fr: "L'Imp√©ratrice", es: "La Emperatriz" },
            { num: 4, id: 'm04', en: "The Emperor", fr: "L'Empereur", es: "El Emperador" },
            { num: 5, id: 'm05', en: "The Hierophant", fr: "Le Pape", es: "El Sumo Sacerdote" },
            { num: 6, id: 'm06', en: "The Lovers", fr: "L'Amoureux", es: "Los Enamorados" },
            { num: 7, id: 'm07', en: "The Chariot", fr: "Le Chariot", es: "El Carro" },
            { num: 8, id: 'm08', en: "Strength", fr: "La Force", es: "La Fuerza" },
            { num: 9, id: 'm09', en: "The Hermit", fr: "L'Hermite", es: "El Ermita√±o" },
            { num: 10, id: 'm10', en: "Wheel of Fortune", fr: "La Roue de Fortune", es: "La Rueda de la Fortuna" },
            { num: 11, id: 'm11', en: "Justice", fr: "La Justice", es: "La Justicia" },
            { num: 12, id: 'm12', en: "The Hanged Man", fr: "Le Pendu", es: "El Colgado" },
            { num: 13, id: 'm13', en: "Death", fr: "La Mort", es: "La Muerte" },
            { num: 14, id: 'm14', en: "Temperance", fr: "Temp√©rance", es: "La Templanza" },
            { num: 15, id: 'm15', en: "The Devil", fr: "Le Diable", es: "El Diablo" },
            { num: 16, id: 'm16', en: "The Tower", fr: "La Maison Dieu", es: "La Torre" },
            { num: 17, id: 'm17', en: "The Star", fr: "L'√âtoile", es: "La Estrella" },
            { num: 18, id: 'm18', en: "The Moon", fr: "La Lune", es: "La Luna" },
            { num: 19, id: 'm19', en: "The Sun", fr: "Le Soleil", es: "El Sol" },
            { num: 20, id: 'm20', en: "Judgement", fr: "Le Jugement", es: "El Juicio" },
            { num: 21, id: 'm21', en: "The World", fr: "Le Monde", es: "El Mundo" },
        ];

        const DICTIONARY = {
            en: { title: "Mystic Tarot", selectCard: "Select a Card", upright: "Upright", reversed: "Reversed", majorArcana: "Major Arcana", wands: "Wands", cups: "Cups", swords: "Swords", pentacles: "Pentacles", back: "Back", flip: "Flip Card", guide: "Guide", keywords: "Interpretation", tapToFlip: "Tap card to invert" },
            fr: { title: "Tarot Mystique", selectCard: "Choisissez une carte", upright: "L'Endroit", reversed: "L'Envers", majorArcana: "Arcanes Majeurs", wands: "B√¢tons", cups: "Coupes", swords: "√âp√©es", pentacles: "Deniers", back: "Retour", flip: "Retourner", guide: "Guide", keywords: "Interpr√©tation", tapToFlip: "Appuyez pour inverser" },
            es: { title: "Tarot M√≠stico", selectCard: "Elige una carta", upright: "Al Derecho", reversed: "Invertida", majorArcana: "Arcanos Mayores", wands: "Bastos", cups: "Copas", swords: "Espadas", pentacles: "Oros", back: "Volver", flip: "Voltear", guide: "Gu√≠a", keywords: "Interpretaci√≥n", tapToFlip: "Toca para invertir" }
        };

        function generateMeanings(name, suit, number, lang) {
            if (lang === 'fr') {
                return { upright: `${name} incarne l'essence de ${suit} sous sa forme num√©ro ${number}. Cela signifie clart√©, √©lan et √©nergie positive concernant le sujet.`, reversed: `√Ä l'envers, ${name} sugg√®re un blocage dans l'√©nergie de ${suit}. Vous pouvez rencontrer des retards ou devoir revoir votre approche.` };
            } else if (lang === 'es') {
                return { upright: `${name} representa la esencia de ${suit} en su forma n√∫mero ${number}. Significa claridad, impulso y energ√≠a positiva con respecto al tema.`, reversed: `Cuando se invierte, ${name} sugiere un bloqueo en la energ√≠a de ${suit}. Es posible que experimente retrasos o necesite revisar su enfoque.` };
            }
            return { upright: `The ${name} represents the essence of ${suit} in its number ${number} form. It signifies clarity, momentum, and positive energy regarding the subject.`, reversed: `When reversed, the ${name} suggests a blockage in the energy of ${suit}. You may be experiencing delays or need to revisit your approach.` };
        }

        const FULL_DECK = [
            ...MAJORS.map(m => ({ ...m, suit: 'major', en: { name: m.en, ...generateMeanings(m.en, "Major Arcana", m.num, 'en') }, fr: { name: m.fr, ...generateMeanings(m.fr, "Arcanes Majeurs", m.num, 'fr') }, es: { name: m.es, ...generateMeanings(m.es, "Arcanos Mayores", m.num, 'es') } })),
            ...SUITS.flatMap(suit => RANKS.map(rank => {
                const prefix = suit.charAt(0);
                const idNum = rank.num.toString().padStart(2, '0');
                return { id: `${prefix}${idNum}`, suit: suit, number: rank.num, en: { name: `${rank.en} of ${DICTIONARY.en[suit]}`, ...generateMeanings(`${rank.en} of ${DICTIONARY.en[suit]}`, suit, rank.num, 'en') }, fr: { name: `${rank.fr} de ${DICTIONARY.fr[suit]}`, ...generateMeanings(`${rank.fr} de ${DICTIONARY.fr[suit]}`, suit, rank.num, 'fr') }, es: { name: `${rank.es} de ${DICTIONARY.es[suit]}`, ...generateMeanings(`${rank.es} de ${DICTIONARY.es[suit]}`, suit, rank.num, 'es') } };
            }))
        ];

        /**
         * --- APP STATE ---
         */
        const state = {
            lang: 'en',
            activeCategory: null,
            selectedCard: null,
            inverted: false,
            animating: false
        };

        /**
         * --- IMAGE LOGIC ---
         */
        function getSacredTextUrl(id) {
            let prefix = id.slice(0, 1);
            let numStr = id.slice(1);
            let num = parseInt(numStr, 10);
            if (prefix === 'm') return `https://www.sacred-texts.com/tarot/pkt/img/ar${numStr}.jpg`;
            let stPrefix = '';
            if (prefix === 'w') stPrefix = 'wa'; else if (prefix === 'c') stPrefix = 'cu'; else if (prefix === 's') stPrefix = 'sw'; else if (prefix === 'p') stPrefix = 'pe';
            let suffix = numStr;
            if (num === 1) suffix = 'ac'; else if (num === 11) suffix = 'pa'; else if (num === 12) suffix = 'kn'; else if (num === 13) suffix = 'qu'; else if (num === 14) suffix = 'ki';
            return `https://www.sacred-texts.com/tarot/pkt/img/${stPrefix}${suffix}.jpg`;
        }

        function handleImageError(img, cardId, isFallback = false) {
            const sacredUrl = getSacredTextUrl(cardId);
            const jsdelivrUrl = `https://cdn.jsdelivr.net/gh/tindogg/tarot-images/cards/${cardId}.jpg`;
            
            // Logic: Source 1 (Sacred) -> Source 2 (JSDelivr) -> Fallback Visual
            if (img.src === sacredUrl) {
                img.src = jsdelivrUrl;
            } else {
                // Both failed, hide image and show fallback sibling
                img.style.display = 'none';
                const fallbackDiv = img.nextElementSibling;
                if (fallbackDiv) fallbackDiv.classList.remove('hidden');
                if (fallbackDiv) fallbackDiv.classList.add('flex');
            }
        }

        /**
         * --- RENDER HELPERS ---
         */
        function renderIcon(name, classes = "w-6 h-6") {
            const svg = ICONS[name] || ICONS.sparkles;
            return svg.replace('<svg ', `<svg class="${classes}" `);
        }

        function getMajorIconName(number) {
            const map = { 0: 'feather', 1: 'sparkles', 2: 'scroll', 3: 'sprout', 4: 'crown', 5: 'key', 6: 'heart', 7: 'shield', 8: 'dna', 9: 'search', 10: 'refresh', 11: 'scale', 12: 'anchor', 13: 'skull', 14: 'droplets', 15: 'flame', 16: 'zap', 17: 'star', 18: 'moon', 19: 'sun', 20: 'bell', 21: 'globe' };
            return map[number] || 'sparkles';
        }

        function renderFallbackVisual(card, size = 'large') {
            let bgClass = 'bg-gray-900';
            if(card.suit === 'major') bgClass = 'bg-purple-900';
            if(card.suit === 'wands') bgClass = 'bg-red-900';
            if(card.suit === 'cups') bgClass = 'bg-blue-900';
            if(card.suit === 'swords') bgClass = 'bg-slate-800';
            if(card.suit === 'pentacles') bgClass = 'bg-emerald-900';

            const isSmall = size === 'small';
            const iconName = card.suit === 'major' ? getMajorIconName(card.number) : card.suit;
            
            return `
            <div class="hidden w-full h-full ${bgClass} relative flex-col items-center justify-between overflow-hidden ${isSmall ? 'p-1' : 'p-4'}">
                <div class="absolute inset-0.5 border border-amber-500/30 rounded flex flex-col items-center justify-between ${isSmall ? 'p-1' : 'p-2'}">
                    <div class="w-full flex justify-between text-amber-200 opacity-60">
                        ${renderIcon(iconName, isSmall ? "w-2 h-2" : "w-5 h-5")}
                        ${!isSmall ? `<span class="font-serif font-bold text-md">${card.number}</span>` : ''}
                    </div>
                    <div class="flex-grow flex items-center justify-center relative">
                        <div class="absolute inset-0 rounded-full blur-xl opacity-40 ${card.suit === 'major' ? 'bg-amber-400' : 'bg-white'}"></div>
                        <div class="relative z-10 text-amber-100 drop-shadow-lg">
                             ${renderIcon(iconName, isSmall ? "w-6 h-6" : "w-24 h-24")}
                        </div>
                    </div>
                    <div class="w-full flex justify-between text-amber-200 opacity-60 rotate-180">
                        ${renderIcon(iconName, isSmall ? "w-2 h-2" : "w-5 h-5")}
                        ${!isSmall ? `<span class="font-serif font-bold text-md">${card.number}</span>` : ''}
                    </div>
                </div>
            </div>`;
        }

        /**
         * --- CORE RENDER ---
         */
        function renderApp() {
            const app = document.getElementById('app');
            
            // --- DETAIL VIEW ---
            if (state.selectedCard) {
                const card = state.selectedCard;
                const info = card[state.lang];
                // Note: We assign IDs to elements here to target them in toggleInverted
                const rotation = state.inverted ? 'rotate-180' : '';
                
                app.innerHTML = `
                <div class="min-h-screen bg-slate-950 text-slate-100 font-sans">
                    <!-- Nav -->
                    <nav class="fixed top-0 left-0 right-0 z-50 p-4 flex items-center justify-between pointer-events-none">
                        <button onclick="navigateBack()" class="pointer-events-auto w-10 h-10 rounded-full bg-slate-900/80 backdrop-blur text-white flex items-center justify-center border border-white/10 shadow-lg active:scale-95 transition-all hover:bg-slate-800">
                            ${renderIcon('arrowLeft', 'w-5 h-5')}
                        </button>
                        <button onclick="toggleLang()" class="pointer-events-auto px-3 py-1 bg-slate-900/80 backdrop-blur rounded-full text-xs font-bold border border-white/10 text-amber-500 uppercase tracking-widest shadow-lg hover:bg-slate-800 transition-colors">
                            ${state.lang}
                        </button>
                    </nav>

                    <!-- Content -->
                    <main class="pt-20 pb-12 px-6 flex flex-col items-center max-w-md mx-auto min-h-screen">
                        
                        <!-- Card Stage -->
                        <div class="w-full max-w-[280px] mb-8 relative group" onclick="toggleInverted()">
                            <div class="absolute inset-0 bg-amber-500/20 blur-3xl rounded-full transition-opacity duration-700 ${state.inverted ? 'opacity-30' : 'opacity-10'}"></div>
                            
                            <!-- Card Container with ID -->
                            <div id="card-container" class="relative w-full aspect-[4/7] cursor-pointer transition-transform duration-700 ease-in-out shadow-2xl rounded-xl overflow-hidden border border-white/10 bg-slate-900 ${rotation}">
                                <img src="${getSacredTextUrl(card.id)}" 
                                        class="w-full h-full object-contain" 
                                        onerror="handleImageError(this, '${card.id}')"
                                        alt="${info.name}">
                                ${renderFallbackVisual(card, 'large')}
                                <div class="absolute inset-0 bg-gradient-to-tr from-black/20 to-white/10 pointer-events-none mix-blend-overlay"></div>
                            </div>

                            <div class="mt-4 text-center">
                                <span class="text-xs text-slate-500 animate-pulse">${DICTIONARY[state.lang].tapToFlip}</span>
                            </div>
                        </div>

                        <!-- Info Card -->
                        <div class="w-full bg-slate-900/50 backdrop-blur-sm rounded-3xl p-6 border border-white/5 shadow-xl animate-fade-in">
                            <div class="text-center mb-6">
                                <h2 id="card-title" class="text-3xl font-serif font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-200 to-amber-500 mb-2">${info.name}</h2>
                                <div id="status-badge" class="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-bold tracking-widest uppercase border transition-colors duration-500 ${state.inverted ? 'bg-indigo-950/50 border-indigo-500/30 text-indigo-300' : 'bg-emerald-950/50 border-emerald-500/30 text-emerald-300'}">
                                    ${renderIcon(state.inverted ? 'moon' : 'sun', 'w-3 h-3')}
                                    ${state.inverted ? DICTIONARY[state.lang].reversed : DICTIONARY[state.lang].upright}
                                </div>
                            </div>
                            <div class="space-y-6">
                                <h3 class="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2 flex items-center gap-2">
                                    ${renderIcon('sparkles', 'w-4 h-4 text-amber-500')}
                                    ${DICTIONARY[state.lang].keywords}
                                </h3>
                                <!-- Description with ID -->
                                <p id="card-description" class="text-lg leading-relaxed font-light text-slate-100 transition-all duration-300">
                                    ${state.inverted ? info.reversed : info.upright}
                                </p>
                            </div>
                            <div class="mt-8 pt-6 border-t border-white/5 flex gap-3">
                                <button onclick="toggleInverted()" class="flex-1 flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 active:bg-slate-600 text-white py-3 rounded-xl transition-all font-medium text-sm">
                                    <div id="btn-icon" class="transition-transform duration-700 ${state.inverted ? 'rotate-180' : ''}">
                                        ${renderIcon('refresh', 'w-4 h-4')}
                                    </div>
                                    ${DICTIONARY[state.lang].flip}
                                </button>
                            </div>
                        </div>
                    </main>
                </div>`;
                return;
            }

            // --- HOME VIEW ---
            const categories = [
                { key: 'major', label: DICTIONARY[state.lang].majorArcana, icon: '‚ú®' },
                { key: 'wands', label: DICTIONARY[state.lang].wands, icon: 'üßô‚Äç‚ôÇÔ∏èüî•' },
                { key: 'cups', label: DICTIONARY[state.lang].cups, icon: 'üèÜüíß' },
                { key: 'swords', label: DICTIONARY[state.lang].swords, icon: 'üó°Ô∏èüí®' },
                { key: 'pentacles', label: DICTIONARY[state.lang].pentacles, icon: '‚≠ê' },
            ];

            const groupedData = {
                major: FULL_DECK.filter(c => c.suit === 'major'),
                wands: FULL_DECK.filter(c => c.suit === 'wands'),
                cups: FULL_DECK.filter(c => c.suit === 'cups'),
                swords: FULL_DECK.filter(c => c.suit === 'swords'),
                pentacles: FULL_DECK.filter(c => c.suit === 'pentacles'),
            };

            let accordionHtml = categories.map(cat => {
                const isActive = state.activeCategory === cat.key;
                const cards = groupedData[cat.key];
                
                const gridHtml = isActive ? `
                    <div class="p-4 pt-0 grid grid-cols-4 gap-2 animate-fade-in">
                        ${cards.map(card => `
                            <div onclick="selectCard('${card.id}')" class="flex flex-col items-center gap-2 p-1 rounded-lg hover:bg-slate-800 border border-transparent hover:border-amber-500/30 transition-all group cursor-pointer">
                                <div class="w-full aspect-[4/7] rounded bg-slate-800 overflow-hidden relative border border-white/5">
                                    <img src="${getSacredTextUrl(card.id)}" loading="lazy" 
                                         class="w-full h-full object-contain opacity-80 group-hover:opacity-100 transition-opacity"
                                         onerror="handleImageError(this, '${card.id}', true)">
                                    ${renderFallbackVisual(card, 'small')}
                                </div>
                                <span class="text-[10px] text-center font-medium text-slate-400 group-hover:text-amber-100 line-clamp-1">
                                    ${card.suit === 'major' ? card[state.lang].name : card.number}
                                </span>
                            </div>
                        `).join('')}
                    </div>` : '';

                return `
                <div class="overflow-hidden bg-slate-900/50 border border-white/5 rounded-2xl shadow-lg transition-all mb-4">
                    <button onclick="toggleCategory('${cat.key}')" class="w-full flex items-center justify-between p-5 text-left active:bg-slate-800/50 transition-colors">
                        <div class="flex items-center gap-4">
                            <span class="text-2xl filter drop-shadow-md">${cat.icon}</span>
                            <div>
                                <span class="text-lg font-medium text-slate-100 block">${cat.label}</span>
                                <span class="text-xs text-slate-500">${cards.length} cards</span>
                            </div>
                        </div>
                        <div class="transition-transform duration-300 ${isActive ? 'rotate-180' : ''} text-slate-400">
                            ${renderIcon('chevronDown', 'w-5 h-5')}
                        </div>
                    </button>
                    <div class="transition-[max-height] duration-500 ease-in-out ${isActive ? 'max-h-[2000px]' : 'max-h-0'}">
                        ${gridHtml}
                    </div>
                </div>`;
            }).join('');

            // Lang dropdown HTML
            const langs = ['en', 'fr', 'es'];
            const langMenu = `
            <div class="relative group z-50">
                <button class="flex items-center gap-2 bg-slate-800 group-hover:bg-slate-700 px-3 py-1.5 rounded-full text-xs font-medium transition-colors border border-white/5">
                    ${renderIcon('globe', 'w-3.5 h-3.5 text-amber-400')}
                    ${state.lang.toUpperCase()}
                    <div class="group-hover:rotate-180 transition-transform">${renderIcon('chevronDown', 'w-3 h-3 text-slate-400')}</div>
                </button>
                <div class="absolute right-0 pt-2 w-32 hidden group-hover:block hover:block animate-fade-in">
                    <div class="bg-slate-900 border border-white/10 rounded-xl shadow-xl overflow-hidden">
                        ${langs.map(l => `
                            <button onclick="setLang('${l}')" class="w-full text-left px-4 py-3 text-sm hover:bg-slate-800 transition-colors flex items-center gap-2 ${state.lang === l ? 'text-amber-400 bg-slate-800/50' : 'text-slate-300'}">
                                <span class="w-4">${state.lang === l ? '‚úì' : ''}</span>
                                ${l === 'en' ? 'English' : l === 'fr' ? 'Fran√ßais' : 'Espa√±ol'}
                            </button>
                        `).join('')}
                    </div>
                </div>
            </div>`;

            app.innerHTML = `
            <div class="min-h-screen bg-slate-950 text-slate-100 font-sans">
                <header class="sticky top-0 z-50 bg-slate-950/80 backdrop-blur-md border-b border-white/10 px-6 py-4 flex items-center justify-between">
                    <div class="flex items-center gap-2">
                        ${renderIcon('sparkles', 'w-6 h-6 text-amber-400 animate-pulse')}
                        <h1 class="text-xl font-bold tracking-wider text-amber-100 font-serif">${DICTIONARY[state.lang].title}</h1>
                    </div>
                    ${langMenu}
                </header>
                <main class="p-4 max-w-lg mx-auto pb-20">
                    ${accordionHtml}
                </main>
            </div>`;
        }

        /**
         * --- ACTIONS ---
         */
        window.toggleCategory = (key) => {
            state.activeCategory = state.activeCategory === key ? null : key;
            renderApp();
        };

        window.selectCard = (id) => {
            state.selectedCard = FULL_DECK.find(c => c.id === id);
            state.inverted = false;
            renderApp();
            window.scrollTo(0, 0);
        };

        window.navigateBack = () => {
            state.selectedCard = null;
            renderApp();
        };

        window.setLang = (lang) => {
            state.lang = lang;
            renderApp();
        };
        
        window.toggleLang = () => {
             const next = state.lang === 'en' ? 'fr' : state.lang === 'fr' ? 'es' : 'en';
             setLang(next);
        };

        // NEW: Invert function that manipulates DOM directly to preserve animation
        window.toggleInverted = () => {
            if (state.animating) return;
            state.animating = true;
            state.inverted = !state.inverted;

            // 1. Visual Rotation
            const cardContainer = document.getElementById('card-container');
            const btnIcon = document.getElementById('btn-icon');
            
            if (state.inverted) {
                cardContainer.classList.add('rotate-180');
                if (btnIcon) btnIcon.classList.add('rotate-180');
            } else {
                cardContainer.classList.remove('rotate-180');
                if (btnIcon) btnIcon.classList.remove('rotate-180');
            }

            // 2. Text Updates (with fade)
            const desc = document.getElementById('card-description');
            const badge = document.getElementById('status-badge');
            
            if (desc) {
                desc.style.opacity = '0.5';
                desc.style.filter = 'blur(4px)';
            }

            setTimeout(() => {
                // Update content
                const card = state.selectedCard;
                const info = card[state.lang];
                
                if (desc) desc.textContent = state.inverted ? info.reversed : info.upright;
                
                // Update Badge
                if (badge) {
                    badge.innerHTML = `
                        ${renderIcon(state.inverted ? 'moon' : 'sun', 'w-3 h-3')}
                        ${state.inverted ? DICTIONARY[state.lang].reversed : DICTIONARY[state.lang].upright}
                    `;
                    badge.className = `inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-bold tracking-widest uppercase border transition-colors duration-500 ${state.inverted ? 'bg-indigo-950/50 border-indigo-500/30 text-indigo-300' : 'bg-emerald-950/50 border-emerald-500/30 text-emerald-300'}`;
                }

                // Fade in text
                if (desc) {
                    desc.style.opacity = '1';
                    desc.style.filter = 'blur(0)';
                }
                
                state.animating = false;
            }, 300);
        };

        // Init
        renderApp();

    </script>
</body>
</html>
