import React, { useState, useMemo, useEffect } from 'react';
import { 
  ChevronDown, ArrowLeft, RefreshCw, Moon, Sun, Sparkles, Globe, 
  Feather, Crown, Key, Heart, Shield, Zap, Search, Scale, Anchor, 
  Skull, Droplets, Flame, Star, Bell, Sprout, Scroll, Dna
} from 'lucide-react';

/**
 * --- DATA & CONFIGURATION ---
 */

const SUITS = ['wands', 'cups', 'swords', 'pentacles'];
const RANKS = [
  { num: 1, en: 'Ace', fr: 'As', es: 'As' },
  { num: 2, en: 'Two', fr: 'Deux', es: 'Dos' },
  { num: 3, en: 'Three', fr: 'Trois', es: 'Tres' },
  { num: 4, en: 'Four', fr: 'Quatre', es: 'Cuatro' },
  { num: 5, en: 'Five', fr: 'Cinq', es: 'Cinco' },
  { num: 6, en: 'Six', fr: 'Six', es: 'Seis' },
  { num: 7, en: 'Seven', fr: 'Sept', es: 'Siete' },
  { num: 8, en: 'Eight', fr: 'Huit', es: 'Ocho' },
  { num: 9, en: 'Nine', fr: 'Neuf', es: 'Nueve' },
  { num: 10, en: 'Ten', fr: 'Dix', es: 'Diez' },
  { num: 11, en: 'Page', fr: 'Valet', es: 'Sota' },
  { num: 12, en: 'Knight', fr: 'Cavalier', es: 'Caballo' },
  { num: 13, en: 'Queen', fr: 'Reine', es: 'Reina' },
  { num: 14, en: 'King', fr: 'Roi', es: 'Rey' },
];

const MAJORS = [
  { num: 0, id: 'm00', en: "The Fool", fr: "Le Mat", es: "El Loco" },
  { num: 1, id: 'm01', en: "The Magician", fr: "Le Bateleur", es: "El Mago" },
  { num: 2, id: 'm02', en: "The High Priestess", fr: "La Papesse", es: "La Sacerdotisa" },
  { num: 3, id: 'm03', en: "The Empress", fr: "L'Imp√©ratrice", es: "La Emperatriz" },
  { num: 4, id: 'm04', en: "The Emperor", fr: "L'Empereur", es: "El Emperador" },
  { num: 5, id: 'm05', en: "The Hierophant", fr: "Le Pape", es: "El Sumo Sacerdote" },
  { num: 6, id: 'm06', en: "The Lovers", fr: "L'Amoureux", es: "Los Enamorados" },
  { num: 7, id: 'm07', en: "The Chariot", fr: "Le Chariot", es: "El Carro" },
  { num: 8, id: 'm08', en: "Strength", fr: "La Force", es: "La Fuerza" },
  { num: 9, id: 'm09', en: "The Hermit", fr: "L'Hermite", es: "El Ermita√±o" },
  { num: 10, id: 'm10', en: "Wheel of Fortune", fr: "La Roue de Fortune", es: "La Rueda de la Fortuna" },
  { num: 11, id: 'm11', en: "Justice", fr: "La Justice", es: "La Justicia" },
  { num: 12, id: 'm12', en: "The Hanged Man", fr: "Le Pendu", es: "El Colgado" },
  { num: 13, id: 'm13', en: "Death", fr: "La Mort", es: "La Muerte" },
  { num: 14, id: 'm14', en: "Temperance", fr: "Temp√©rance", es: "La Templanza" },
  { num: 15, id: 'm15', en: "The Devil", fr: "Le Diable", es: "El Diablo" },
  { num: 16, id: 'm16', en: "The Tower", fr: "La Maison Dieu", es: "La Torre" },
  { num: 17, id: 'm17', en: "The Star", fr: "L'√âtoile", es: "La Estrella" },
  { num: 18, id: 'm18', en: "The Moon", fr: "La Lune", es: "La Luna" },
  { num: 19, id: 'm19', en: "The Sun", fr: "Le Soleil", es: "El Sol" },
  { num: 20, id: 'm20', en: "Judgement", fr: "Le Jugement", es: "El Juicio" },
  { num: 21, id: 'm21', en: "The World", fr: "Le Monde", es: "El Mundo" },
];

const DICTIONARY = {
  en: {
    title: "Mystic Tarot",
    selectCard: "Select a Card",
    upright: "Upright",
    reversed: "Reversed",
    majorArcana: "Major Arcana",
    wands: "Wands",
    cups: "Cups",
    swords: "Swords",
    pentacles: "Pentacles",
    back: "Back",
    flip: "Flip Card",
    guide: "Guide",
    keywords: "Interpretation",
    tapToFlip: "Tap card to invert"
  },
  fr: {
    title: "Tarot Mystique",
    selectCard: "Choisissez une carte",
    upright: "L'Endroit",
    reversed: "L'Envers",
    majorArcana: "Arcanes Majeurs",
    wands: "B√¢tons",
    cups: "Coupes",
    swords: "√âp√©es",
    pentacles: "Deniers",
    back: "Retour",
    flip: "Retourner",
    guide: "Guide",
    keywords: "Interpr√©tation",
    tapToFlip: "Appuyez pour inverser"
  },
  es: {
    title: "Tarot M√≠stico",
    selectCard: "Elige una carta",
    upright: "Al Derecho",
    reversed: "Invertida",
    majorArcana: "Arcanos Mayores",
    wands: "Bastos",
    cups: "Copas",
    swords: "Espadas",
    pentacles: "Oros",
    back: "Volver",
    flip: "Voltear",
    guide: "Gu√≠a",
    keywords: "Interpretaci√≥n",
    tapToFlip: "Toca para invertir"
  }
};

// Localized meanings generator
const generateMeanings = (name, suit, number, lang) => {
  if (lang === 'fr') {
    return {
      upright: `${name} incarne l'essence de ${suit} sous sa forme num√©ro ${number}. Cela signifie clart√©, √©lan et √©nergie positive concernant le sujet.`,
      reversed: `√Ä l'envers, ${name} sugg√®re un blocage dans l'√©nergie de ${suit}. Vous pouvez rencontrer des retards ou devoir revoir votre approche.`
    };
  } else if (lang === 'es') {
    return {
      upright: `${name} representa la esencia de ${suit} en su forma n√∫mero ${number}. Significa claridad, impulso y energ√≠a positiva con respecto al tema.`,
      reversed: `Cuando se invierte, ${name} sugiere un bloqueo en la energ√≠a de ${suit}. Es posible que experimente retrasos o necesite revisar su enfoque.`
    };
  } else {
    // English default
    return {
      upright: `The ${name} represents the essence of ${suit} in its number ${number} form. It signifies clarity, momentum, and positive energy regarding the subject.`,
      reversed: `When reversed, the ${name} suggests a blockage in the energy of ${suit}. You may be experiencing delays or need to revisit your approach.`
    };
  }
};

// Build the full 78 card deck
const FULL_DECK = [
  ...MAJORS.map(m => ({
    ...m,
    suit: 'major',
    en: { name: m.en, ...generateMeanings(m.en, "Major Arcana", m.num, 'en') },
    fr: { name: m.fr, ...generateMeanings(m.fr, "Arcanes Majeurs", m.num, 'fr') },
    es: { name: m.es, ...generateMeanings(m.es, "Arcanos Mayores", m.num, 'es') }
  })),
  ...SUITS.flatMap(suit => 
    RANKS.map(rank => {
      const prefix = suit.charAt(0);
      const idNum = rank.num.toString().padStart(2, '0');
      return {
        id: `${prefix}${idNum}`,
        suit: suit,
        number: rank.num,
        en: { 
          name: `${rank.en} of ${DICTIONARY.en[suit]}`, 
          ...generateMeanings(`${rank.en} of ${DICTIONARY.en[suit]}`, suit, rank.num, 'en') 
        },
        fr: { 
          name: `${rank.fr} de ${DICTIONARY.fr[suit]}`, 
          ...generateMeanings(`${rank.fr} de ${DICTIONARY.fr[suit]}`, suit, rank.num, 'fr') 
        },
        es: { 
          name: `${rank.es} de ${DICTIONARY.es[suit]}`, 
          ...generateMeanings(`${rank.es} de ${DICTIONARY.es[suit]}`, suit, rank.num, 'es') 
        },
      };
    })
  )
];

/**
 * --- VISUAL COMPONENTS ---
 */

// 1. IMPROVED FALLBACK VISUAL
// Uses specific icons for every Major Arcana card
const CardIcon = ({ suit, number, className }) => {
  // SUITS
  if (suit === 'cups') return <svg className={className} viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C7.58 2 4 5.58 4 10C4 14.42 7.58 18 12 18C16.42 18 20 14.42 20 10C20 5.58 16.42 2 12 2ZM6 10C6 6.69 8.69 4 12 4C15.31 4 18 6.69 18 10C18 13.31 15.31 16 12 16C8.69 16 6 13.31 6 10Z"/><path d="M12 19C8.13 19 5 20.57 5 22H19C19 20.57 15.87 19 12 19Z"/></svg>;
  if (suit === 'swords') return <svg className={className} viewBox="0 0 24 24" fill="currentColor"><path d="M11 2L13 2L13 16L17 18L12 22L7 18L11 16L11 2Z"/></svg>;
  if (suit === 'wands') return <svg className={className} viewBox="0 0 24 24" fill="currentColor"><path d="M10 2L14 2L13 22L11 22L10 2Z"/></svg>;
  if (suit === 'pentacles') return <svg className={className} viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="8" stroke="currentColor" strokeWidth="2" fill="none" /><path d="M12 4L14.5 9.5L20 10L16 14L17.5 20L12 17L6.5 20L8 14L4 10L9.5 9.5L12 4Z" /></svg>;

  // MAJOR ARCANA SPECIFIC ICONS
  if (suit === 'major') {
    switch (number) {
      case 0: return <Feather className={className} />; // Fool: Lightness, journey
      case 1: return <Sparkles className={className} />; // Magician: Magic
      case 2: return <Scroll className={className} />; // Priestess: Knowledge
      case 3: return <Sprout className={className} />; // Empress: Nature/Growth
      case 4: return <Crown className={className} />; // Emperor: Authority
      case 5: return <Key className={className} />; // Hierophant: Keys to wisdom
      case 6: return <Heart className={className} />; // Lovers: Love
      case 7: return <Shield className={className} />; // Chariot: Protection/Will
      case 8: return <Dna className={className} />; // Strength: Inner strength/Biology
      case 9: return <Search className={className} />; // Hermit: Seeking
      case 10: return <RefreshCw className={className} />; // Wheel: Turning
      case 11: return <Scale className={className} />; // Justice: Balance
      case 12: return <Anchor className={className} />; // Hanged Man: Stuck/Suspended
      case 13: return <Skull className={className} />; // Death
      case 14: return <Droplets className={className} />; // Temperance: Mixing
      case 15: return <Flame className={className} />; // Devil: Passion/Hellfire
      case 16: return <Zap className={className} />; // Tower: Sudden strike
      case 17: return <Star className={className} />; // Star
      case 18: return <Moon className={className} />; // Moon
      case 19: return <Sun className={className} />; // Sun
      case 20: return <Bell className={className} />; // Judgement: Call/Awakening
      case 21: return <Globe className={className} />; // World: Completion
      default: return <Sparkles className={className} />;
    }
  }

  return <Sparkles className={className} />;
};

const FallbackVisual = ({ card, size = 'large' }) => {
  const getBgColor = () => {
    switch (card.suit) {
      case 'major': return 'bg-purple-900';
      case 'wands': return 'bg-red-900';
      case 'cups': return 'bg-blue-900';
      case 'swords': return 'bg-slate-800';
      case 'pentacles': return 'bg-emerald-900';
      default: return 'bg-gray-900';
    }
  };

  const isSmall = size === 'small';

  return (
    <div className={`w-full h-full ${getBgColor()} relative flex flex-col items-center justify-between overflow-hidden ${isSmall ? 'p-1' : 'p-4'}`}>
       <div className={`absolute inset-0.5 border border-amber-500/30 rounded flex flex-col items-center justify-between ${isSmall ? 'p-1' : 'p-2'}`}>
        <div className="w-full flex justify-between text-amber-200 opacity-60">
           <CardIcon suit={card.suit} number={card.number} className={isSmall ? "w-2 h-2" : "w-5 h-5"} />
           {!isSmall && <span className="font-serif font-bold text-md">{card.number}</span>}
        </div>
        
        <div className="flex-grow flex items-center justify-center relative">
            <div className={`absolute inset-0 rounded-full blur-xl opacity-40 ${card.suit === 'major' ? 'bg-amber-400' : 'bg-white'}`}></div>
            <CardIcon suit={card.suit} number={card.number} className={`${isSmall ? "w-6 h-6" : "w-24 h-24"} text-amber-100 drop-shadow-lg relative z-10`} />
        </div>

        <div className="w-full flex justify-between text-amber-200 opacity-60 rotate-180">
           <CardIcon suit={card.suit} number={card.number} className={isSmall ? "w-2 h-2" : "w-5 h-5"} />
           {!isSmall && <span className="font-serif font-bold text-md">{card.number}</span>}
        </div>
      </div>
    </div>
  );
};


// 2. UNIVERSAL SMART IMAGE COMPONENT
// Fixed URL mapping for Sacred Texts
const SmartCardImage = ({ card, inverted = false, onClick, variant = 'full' }) => {
  // Helper to map our IDs (m00, w01) to Sacred Texts IDs (ar00, waac, wa02, wapa...)
  const getSacredTextUrl = (id) => {
    let prefix = id.slice(0, 1);
    let numStr = id.slice(1);
    let num = parseInt(numStr, 10);
    
    // Major Arcana simply use 'ar' prefix
    if (prefix === 'm') {
        return `https://www.sacred-texts.com/tarot/pkt/img/ar${numStr}.jpg`;
    }

    // Determine suit prefix
    let stPrefix = '';
    if (prefix === 'w') stPrefix = 'wa';
    else if (prefix === 'c') stPrefix = 'cu';
    else if (prefix === 's') stPrefix = 'sw';
    else if (prefix === 'p') stPrefix = 'pe';

    // Determine suffix (Ace/Court cards use letters)
    let suffix = numStr;
    if (num === 1) suffix = 'ac';      // Ace
    else if (num === 11) suffix = 'pa'; // Page
    else if (num === 12) suffix = 'kn'; // Knight
    else if (num === 13) suffix = 'qu'; // Queen
    else if (num === 14) suffix = 'ki'; // King

    return `https://www.sacred-texts.com/tarot/pkt/img/${stPrefix}${suffix}.jpg`;
  };

  // Strategy: 
  // 1. Try Sacred Texts (With fixed mapping)
  // 2. Try JSDelivr (Original IDs)
  const sources = [
    getSacredTextUrl(card.id),
    `https://cdn.jsdelivr.net/gh/tindogg/tarot-images/cards/${card.id}.jpg`
  ];

  const [currentSrcIndex, setCurrentSrcIndex] = useState(0);
  const [hasFailed, setHasFailed] = useState(false);
  
  // Reset state when card changes
  useEffect(() => {
    setCurrentSrcIndex(0);
    setHasFailed(false);
  }, [card.id]);

  const handleError = () => {
    if (currentSrcIndex < sources.length - 1) {
      setCurrentSrcIndex(prev => prev + 1);
    } else {
      setHasFailed(true);
    }
  };

  const isThumbnail = variant === 'thumbnail';

  // Base classes for container
  const containerClasses = isThumbnail
    ? "w-full aspect-[2/3] rounded bg-slate-800 overflow-hidden relative border border-white/5"
    : `relative w-full aspect-[3/5] cursor-pointer group`;

  const innerClasses = isThumbnail
    ? "w-full h-full transition-opacity hover:opacity-100"
    : `w-full h-full transition-transform duration-700 ease-in-out shadow-2xl rounded-xl overflow-hidden border border-white/10 bg-slate-900`;

  const styleProps = isThumbnail ? {} : {
     transform: inverted ? 'rotate(180deg)' : 'rotate(0deg)'
  };

  if (isThumbnail) {
      return (
        <div className={containerClasses} onClick={onClick}>
             {!hasFailed ? (
                <img 
                    src={sources[currentSrcIndex]} 
                    alt={card.en.name}
                    className="w-full h-full object-cover opacity-80"
                    onError={handleError}
                    loading="lazy"
                />
             ) : (
                <FallbackVisual card={card} size="small" />
             )}
        </div>
      );
  }

  // Full size interactive card
  return (
    <div className={containerClasses} onClick={onClick}>
      <div className={innerClasses} style={styleProps}>
        {!hasFailed ? (
          <>
            <img 
              src={sources[currentSrcIndex]} 
              alt={card.en.name}
              className="w-full h-full object-cover"
              onError={handleError}
              loading="eager"
            />
            <div className="absolute inset-0 bg-gradient-to-tr from-black/20 to-white/10 pointer-events-none mix-blend-overlay"></div>
          </>
        ) : (
          <FallbackVisual card={card} size="large" />
        )}
      </div>
    </div>
  );
};


/**
 * --- MAIN APPLICATION ---
 */
export default function App() {
  const [lang, setLang] = useState('en');
  const [activeCategory, setActiveCategory] = useState(null);
  const [selectedCard, setSelectedCard] = useState(null);
  const [inverted, setInverted] = useState(false);
  const [isAnimating, setIsAnimating] = useState(false);

  // Memoize data
  const organizedData = useMemo(() => ({
    major: FULL_DECK.filter(c => c.suit === 'major'),
    wands: FULL_DECK.filter(c => c.suit === 'wands'),
    cups: FULL_DECK.filter(c => c.suit === 'cups'),
    swords: FULL_DECK.filter(c => c.suit === 'swords'),
    pentacles: FULL_DECK.filter(c => c.suit === 'pentacles'),
  }), []);

  const categories = [
    { key: 'major', label: DICTIONARY[lang].majorArcana, icon: '‚ú®' },
    { key: 'wands', label: DICTIONARY[lang].wands, icon: 'üßô‚Äç‚ôÇÔ∏èüî•' },
    { key: 'cups', label: DICTIONARY[lang].cups, icon: 'üèÜüíß' },
    { key: 'swords', label: DICTIONARY[lang].swords, icon: 'üó°Ô∏èüí®' },
    { key: 'pentacles', label: DICTIONARY[lang].pentacles, icon: '‚≠ê' },
  ];

  const handleCardSelect = (card) => {
    setSelectedCard(card);
    setInverted(false);
    window.scrollTo(0, 0);
  };

  const toggleInverted = () => {
    if (isAnimating) return;
    setIsAnimating(true);
    setInverted(!inverted);
    setTimeout(() => setIsAnimating(false), 700);
  };

  const toggleCategory = (key) => {
    setActiveCategory(activeCategory === key ? null : key);
  };

  // --- HOME VIEW ---
  if (!selectedCard) {
    return (
      <div className="min-h-screen bg-slate-950 text-slate-100 font-sans selection:bg-amber-500/30">
        
        {/* Header */}
        <header className="sticky top-0 z-50 bg-slate-950/80 backdrop-blur-md border-b border-white/10 px-6 py-4 flex items-center justify-between">
          <div className="flex items-center gap-2">
            <Sparkles className="w-6 h-6 text-amber-400 animate-pulse" />
            <h1 className="text-xl font-bold tracking-wider text-amber-100 font-serif">
              {DICTIONARY[lang].title}
            </h1>
          </div>
          
          {/* Language Switcher - Hover Dropdown */}
          <div className="relative group z-50">
            <button className="flex items-center gap-2 bg-slate-800 group-hover:bg-slate-700 px-3 py-1.5 rounded-full text-xs font-medium transition-colors border border-white/5">
              <Globe className="w-3.5 h-3.5 text-amber-400" />
              {lang.toUpperCase()}
              <ChevronDown className="w-3 h-3 text-slate-400 group-hover:rotate-180 transition-transform" />
            </button>
            
            {/* Dropdown Menu */}
            <div className="absolute right-0 pt-2 w-32 hidden group-hover:block hover:block animate-in fade-in slide-in-from-top-2">
              <div className="bg-slate-900 border border-white/10 rounded-xl shadow-xl overflow-hidden">
                {['en', 'fr', 'es'].map((l) => (
                    <button
                    key={l}
                    onClick={() => setLang(l)}
                    className={`w-full text-left px-4 py-3 text-sm hover:bg-slate-800 transition-colors flex items-center gap-2 ${lang === l ? 'text-amber-400 bg-slate-800/50' : 'text-slate-300'}`}
                    >
                    <span className="w-4">{lang === l && '‚úì'}</span>
                    {l === 'en' ? 'English' : l === 'fr' ? 'Fran√ßais' : 'Espa√±ol'}
                    </button>
                ))}
              </div>
            </div>
          </div>
        </header>

        {/* Main Content */}
        <main className="p-4 max-w-lg mx-auto pb-20">
          <div className="space-y-4">
            {categories.map((cat) => (
              <div key={cat.key} className="overflow-hidden bg-slate-900/50 border border-white/5 rounded-2xl shadow-lg transition-all">
                
                {/* Accordion Header */}
                <button
                  onClick={() => toggleCategory(cat.key)}
                  className="w-full flex items-center justify-between p-5 text-left active:bg-slate-800/50 transition-colors"
                >
                  <div className="flex items-center gap-4">
                    <span className="text-2xl filter drop-shadow-md">{cat.icon}</span>
                    <div>
                        <span className="text-lg font-medium text-slate-100 block">{cat.label}</span>
                        <span className="text-xs text-slate-500">{organizedData[cat.key].length} cards</span>
                    </div>
                  </div>
                  <ChevronDown 
                    className={`w-5 h-5 text-slate-400 transition-transform duration-300 ${activeCategory === cat.key ? 'rotate-180' : ''}`}
                  />
                </button>

                {/* Accordion Content */}
                <div 
                    className={`transition-[max-height,opacity] duration-500 ease-in-out ${activeCategory === cat.key ? 'max-h-[2000px] opacity-100' : 'max-h-0 opacity-0'}`}
                >
                    <div className="p-4 pt-0 grid grid-cols-4 gap-2">
                        {organizedData[cat.key].map(card => (
                        <div
                            key={card.id}
                            className="flex flex-col items-center gap-2 p-1 rounded-lg hover:bg-slate-800 border border-transparent hover:border-amber-500/30 transition-all group cursor-pointer"
                            onClick={() => handleCardSelect(card)}
                        >
                             <SmartCardImage card={card} variant="thumbnail" />
                            <span className="text-[10px] text-center font-medium text-slate-400 group-hover:text-amber-100 line-clamp-1">
                                {card.suit === 'major' ? card[lang].name : `${card.number}`}
                            </span>
                        </div>
                        ))}
                    </div>
                </div>
              </div>
            ))}
          </div>
        </main>
      </div>
    );
  }

  // --- DETAIL VIEW ---
  const cardInfo = selectedCard[lang];
  
  return (
    <div className="min-h-screen bg-slate-950 text-slate-100 font-sans selection:bg-amber-500/30">
      
      {/* Navigation Header */}
      <nav className="fixed top-0 left-0 right-0 z-50 p-4 flex items-center justify-between pointer-events-none">
        <button 
          onClick={() => setSelectedCard(null)}
          className="pointer-events-auto w-10 h-10 rounded-full bg-slate-900/80 backdrop-blur text-white flex items-center justify-center border border-white/10 shadow-lg active:scale-95 transition-all hover:bg-slate-800"
        >
          <ArrowLeft className="w-5 h-5" />
        </button>
        <div className="pointer-events-auto">
             {/* Language Switcher (Simple Toggle for Detail View) */}
            <button 
                onClick={() => setLang(lang === 'en' ? 'fr' : lang === 'fr' ? 'es' : 'en')}
                className="px-3 py-1 bg-slate-900/80 backdrop-blur rounded-full text-xs font-bold border border-white/10 text-amber-500 uppercase tracking-widest shadow-lg hover:bg-slate-800 transition-colors"
            >
                {lang}
            </button>
        </div>
      </nav>

      {/* Main Content Area */}
      <main className="pt-20 pb-12 px-6 flex flex-col items-center max-w-md mx-auto min-h-screen">
        
        {/* Card Stage */}
        <div className="w-full max-w-[280px] mb-8 relative group">
           {/* Background Glow */}
           <div className={`absolute inset-0 bg-amber-500/20 blur-3xl rounded-full transition-opacity duration-700 ${inverted ? 'opacity-30' : 'opacity-10'}`}></div>
           
           <SmartCardImage 
             card={selectedCard} 
             inverted={inverted} 
             onClick={toggleInverted}
             variant="full"
           />
           
           <div className="mt-4 text-center">
             <span className="text-xs text-slate-500 animate-pulse">{DICTIONARY[lang].tapToFlip}</span>
           </div>
        </div>

        {/* Info Card */}
        <div className="w-full bg-slate-900/50 backdrop-blur-sm rounded-3xl p-6 border border-white/5 shadow-xl animate-in fade-in slide-in-from-bottom-8 duration-700">
            
            {/* Header: Name & Orientation */}
            <div className="text-center mb-6">
                <h2 className="text-3xl font-serif font-bold text-transparent bg-clip-text bg-gradient-to-r from-amber-200 to-amber-500 mb-2">
                    {cardInfo.name}
                </h2>
                <div className={`inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-bold tracking-widest uppercase border transition-colors duration-500 ${inverted ? 'bg-indigo-950/50 border-indigo-500/30 text-indigo-300' : 'bg-emerald-950/50 border-emerald-500/30 text-emerald-300'}`}>
                    {inverted ? <Moon className="w-3 h-3" /> : <Sun className="w-3 h-3" />}
                    {inverted ? DICTIONARY[lang].reversed : DICTIONARY[lang].upright}
                </div>
            </div>

            {/* Meaning Content */}
            <div className="space-y-6">
                <div className={`transition-all duration-500 ${isAnimating ? 'opacity-50 blur-sm' : 'opacity-100 blur-0'}`}>
                    <h3 className="text-sm font-semibold text-slate-400 uppercase tracking-wider mb-2 flex items-center gap-2">
                        <Sparkles className="w-4 h-4 text-amber-500" />
                        {DICTIONARY[lang].keywords}
                    </h3>
                    <p className="text-lg leading-relaxed font-light text-slate-100">
                        {inverted ? cardInfo.reversed : cardInfo.upright}
                    </p>
                </div>
            </div>

            {/* Action Buttons */}
            <div className="mt-8 pt-6 border-t border-white/5 flex gap-3">
                <button 
                    onClick={toggleInverted}
                    className="flex-1 flex items-center justify-center gap-2 bg-slate-800 hover:bg-slate-700 active:bg-slate-600 text-white py-3 rounded-xl transition-all font-medium text-sm group"
                >
                    <RefreshCw className={`w-4 h-4 transition-transform duration-700 ${isAnimating ? 'rotate-180' : ''}`} />
                    {DICTIONARY[lang].flip}
                </button>
            </div>

        </div>

      </main>
    </div>
  );
}
